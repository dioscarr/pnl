@inject TaxFormService service
@inject IJSRuntime js 

<div class="container ">
    <div class="row">
        <div class="col-sm-12">
            <div id="mininavigation">
                <div class="mini-navigation-inner-box">
                    <button id="viewDocument">
                        <img src="/img/document-management-icon-sm.svg" class="viewDocIcon">
                        <span> View Your Documents</span>
                    </button>
                    <button id="SaveAndReturn">
                        <img src="/img/home-icon.svg" class="viewDocIcon">
                        <span>Save & Return To Dashboard</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div style="min-height:100%; padding-bottom:90px;">
    <div class="container main-border">

        <div class="row">
            <div class="col-sm-12">
                <div class="steps-top-nav">
                    <span class="steps-box"@onclick="async()=>await Goto(1)"><div class="step-number">STEP 1</div><div class="step-caption">Basic Information</div></span>
                    <span class="steps-box"@onclick="async()=>await Goto(2)"><div class="step-number step-number-active">STEP 2</div><div class="step-caption">Personal information</div></span>
                    <span class="steps-box"@onclick="async()=>await Goto(3)"><div class="step-number">STEP 3</div><div class="step-caption">income</div></span>
                    <span class="steps-box"@onclick="async()=>await Goto(4)"><div class="step-number">STEP 4</div><div class="step-caption">Additional Information</div></span>
                    <span class="steps-box"@onclick="async()=>await Goto(5)"><div class="step-number">STEP 5</div><div class="step-caption">review</div></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="hr-line">
                    <hr />
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 ">
                <div class="section-title">
                    <h3 class="fw700">Personal Information</h3>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 col-md-5">
                <div class="the-row-column-title">
                    <h6>First Name</h6>
                </div>
                <div class="the-row-column-content">
                    <input class="form-control" name="first-name" type="text" @bind-value="@st2.CurrentUserInfo.FirstName" />
                </div>
            </div>
            <div class="col-sm-12 col-md-2">
                <div class="the-row-column-title">
                    <h6>M.I</h6>
                </div>
                <div class="the-row-column-content">
                    <input class="form-control" name="M-I" type="text" @bind-value="@st2.CurrentUserInfo.MiddleName" />
                </div>
            </div>

            <div class="col-sm-12 col-md-5">
                <div class="the-row-column-title">
                    <h6>Last Name</h6>
                </div>
                <div class="the-row-column-content">
                    <input class="form-control" name="Last-Name" type="text" @bind-value="@st2.CurrentUserInfo.LastName" />
                </div>
            </div>
        </div>
        <div class="row bottom-padding  ">
            <div class="col-sm-4">
                <div class="the-row-column-title">
                    <h6>Telephone</h6>
                </div>
                <div class="the-row-column-content">
                    <input class="form-control" name="Telephone" type="text" @bind-value="@st2.CurrentUserInfo.Phone" />
                </div>
            </div>
            <div class="col-sm-3">
                <div class="the-row-column-title">
                    <h6>Date of birth</h6>
                </div>
                <div class="the-row-column-content">
                    <input class="form-control" name="birthdate" type="date" @bind-value="@st2.CurrentUserInfo.Birthday" />
                    <i>mm/dd/yyy</i>
                </div>
            </div>
            <div class="col-sm-5">

                <div class="the-row-column-title">
                    <h6>Your Job Title</h6>
                </div>
                <div class="the-row-column-content">
                    <input class="form-control" name="job-title" type="text" @bind-value="@st2.CurrentUserInfo.Occupation" />
                </div>
            </div>

        </div>

        @foreach (var item in formSteps.Where(c => c.TheStep == 2 && c.Section == 2).ToList())
        {

            <div class="row">
                <div class="col-sm-4">
                    <div class="the-row-column-title">
                        <div>@item.Questions.First(c => c.Order == 1).TheQuestion</div>
                    </div>
                    <div class="the-row-column-content">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio"
                                   id="isCitizenrdyes"
                                   name="@item.Questions.First(c => c.Order == 1).Id"
                                   checked="@(GetRadioState(item.Questions.First(c => c.Order == 1).Id, "Yes"))"
                                   @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 1).Id, "Yes"))" />
                            <label class="form-check-label" for="isCitizenrdyes">Yes</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio"
                                   id="isCitizenrdno"
                                   name="@item.Questions.First(c => c.Order == 1).Id"
                                   checked="@(GetRadioState(item.Questions.First(c => c.Order == 1).Id, "No"))"
                                   @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 1).Id, "No"))" />
                            <label class="form-check-label" for="isCitizenrdno"> No </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="the-row-column-content">
                        <div>
                            <h5>Last Year, were you:</h5>
                        </div>
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    <h6>@item.Questions.First(c => c.Order == 2).TheQuestion</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               id="isFullTimeStudentno"
                                               name="@item.Questions.First(c => c.Order == 2).Id"
                                               checked="@(GetRadioState(item.Questions.First(c => c.Order == 2).Id, "Yes"))"
                                               @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 2).Id, "Yes"))" />
                                        <label class="form-check-label" for="isFullTimeStudentyes">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               id="isFullTimeStudentno"
                                               name="@item.Questions.First(c => c.Order == 2).Id"
                                               checked="@(GetRadioState(item.Questions.First(c => c.Order == 2).Id, "No"))"
                                               @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 2).Id, "No"))" />
                                        <label class="form-check-label" for="isFullTimeStudentno"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    <h6>@item.Questions.First(c => c.Order == 3).TheQuestion</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               id="isDisabledyes"
                                               name="@item.Questions.First(c => c.Order == 3).Id"
                                               checked="@(GetRadioState(item.Questions.First(c => c.Order == 3).Id, "Yes"))"
                                               @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 3).Id, "Yes"))" />
                                        <label class="form-check-label" for="isDisabledyes">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               id="isDisabledno"
                                               name="@item.Questions.First(c => c.Order == 3).Id"
                                               checked="@(GetRadioState(item.Questions.First(c => c.Order == 3).Id, "No"))"
                                               @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 3).Id, "No"))" />
                                        <label class="form-check-label" for="isDisabledno"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    <h6>@item.Questions.First(c => c.Order == 4).TheQuestion</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="isBlindyes" name="@item.Questions.First(c => c.Order == 4).Id"
                                               checked="@(GetRadioState(item.Questions.First(c => c.Order == 4).Id, "Yes"))"
                                               @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 4).Id, "Yes"))" />
                                        <label class="form-check-label" for="isBlindyes">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" id="isBlindno" name="@item.Questions.First(c => c.Order == 4).Id"
                                               checked="@(GetRadioState(item.Questions.First(c => c.Order == 4).Id, "No"))"
                                               @onchange="@(() => SetAnswer(item.Questions.First(c => c.Order == 4).Id, "No"))" />
                                        <label class="form-check-label" for="isBlindno"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row bottom-padding">
                <div class="col-sm-12">
                    <div class="the-row-column-title">
                        <h6> Mailing Address</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control" type="text" name="MailingAddress" @bind-value="UserCurrentAddress.Address1" />
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="the-row-column-title">
                        <h6>Apt # / Suite</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control" type="text" name="apt" @bind-value="UserCurrentAddress.Address2" />
                    </div>
                </div>

                <div class="col-sm-2">
                    <div class="the-row-column-title">
                        <h6>City</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control" type="text" name="City" @bind-value="UserCurrentAddress.City" />
                    </div>
                </div>
                <div class="col-sm-2">
                    <div class="the-row-column-title">
                        <h6>State</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control" type="text" name="State" @bind-value="UserCurrentAddress.State" />
                    </div>
                </div>
                <div class="col-sm-5">
                    <div class="the-row-column-title">
                        <h6>Zip Code</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control" type="text" name="Zip" @bind-value="UserCurrentAddress.Zip" />
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="the-row-column-title">
                        <h6>As of December 31, 2019, were you:</h6>
                    </div>
                </div>
            </div>
        }
        @foreach (var item in formSteps.Where(c => c.TheStep == 2 && c.Section == 2).ToList())
        {
            <div class="row">
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title ">
                        <div class="form-check ">
                            <input class="form-check-input" type="radio" 
                                   id="NeverMarriedid"
                                   name="@item.Questions.First(c=>c.Order==5).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==5).Id,"Never Married"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==5).Id,"Never Married"))" />
                            <label class="form-check-label" for="NeverMarriedid">
                                Never Married
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-9  border-bottom">
                    <div class="the-row-column-title ">
                        <i>
                            (This includes registered domestic partnerships, civil unions, or
                            other formal relationships under state law)
                        </i>
                    </div>
                </div>
                <div class="col-sm-3  border-bottom">
                    <div class="the-row-column-title">
                        <div class="form-check ">
                            <input class="form-check-input" type="radio"
                                   id="Marriedid"
                                   name="@item.Questions.First(c=>c.Order==5).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==5).Id,"Married"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==5).Id,"Married"))" />
                            <label class="form-check-label" for="Marriedid">
                                Married
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-9  border-bottom">
                    <div class="the-row-column-title ">
                        <span class="inline-radio-box">
                            <h6>@item.Questions.First(c => c.Order == 6).TheQuestion</h6>
                            <span class="form-check form-check-inline">
                                <input class="form-check-input"
                                       id="gotMarryLastYearyes"
                                       type="radio" disabled="@(enabled == 1? false:"disabled")"
                                       name="@item.Questions.First(c=>c.Order==6).Id"
                                       checked="@(GetRadioState(item.Questions.First(c=>c.Order==6).Id,"Yes"))"
                                       @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==6).Id,"Yes"))" />
                                <label class="form-check-label" for="gotMarryLastYearyes">Yes</label>
                            </span>
                            <span class="form-check form-check-inline">
                                <input class="form-check-input" type="radio"
                                       id="gotMarryLastYearno"
                                       disabled="@(enabled == 1? false:"disabled")"
                                       name="@item.Questions.First(c=>c.Order==6).Id"
                                       checked="@(GetRadioState(item.Questions.First(c=>c.Order==6).Id,"No"))"
                                       @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==6).Id,"No"))" />
                                <label class="form-check-label" for="gotMarryLastYearno"> No </label>
                            </span>
                        </span>
                    </div>
                    <div class="the-row-column-title ">
                        <span class="inline-radio-box">
                            <h6>
                                @item.Questions.First(c => c.Order == 7).TheQuestion
                            </h6>
                            <span class="form-check form-check-inline">
                                <input class="form-check-input" type="radio"
                                       id="isSixMonthlivingWithSpouseyes"
                                       disabled="@(enabled == 1? false:"disabled")"
                                       name="@item.Questions.First(c=>c.Order==7).Id"
                                       checked="@(GetRadioState(item.Questions.First(c=>c.Order==7).Id,"Yes"))"
                                       @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==7).Id,"Yes"))" />
                                <label class="form-check-label" for="isSixMonthlivingWithSpouseyes">Yes</label>
                            </span>
                            <span class="form-check form-check-inline">
                                <input class="form-check-input" type="radio"
                                       id="isSixMonthlivingWithSpouseno"disabled="@(enabled == 1? false:"disabled")"
                                       name="@item.Questions.First(c=>c.Order==7).Id"
                                       checked="@(GetRadioState(item.Questions.First(c=>c.Order==7).Id,"No"))"
                                       @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==7).Id,"No"))" />
                                <label class="form-check-label" for="isSixMonthlivingWithSpouseno"> No </label>
                            </span>
                        </span>
                    </div>
                </div>
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title">
                        <div class="form-check ">
                            <input class="form-check-input" type="radio"
                                   id="Divorceid"
                                   name="@item.Questions.First(c=>c.Order==5).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==5).Id,"Divoced"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==5).Id,"Divoced"))" />
                            <label class="form-check-label" for="Divorceid">
                                Divoced
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title ">
                        <h6> @item.Questions.First(c => c.Order == 12).TheQuestion</h6>
                    </div>
                </div>
                <div class="col-sm-6 border-bottom">
                    <div class="the-row-column-title">
                        <input class="form-control width1" type="date" @bind-value="DateOfFinalDecree" disabled="@(enabled == 2? false:"disabled")" />
                    </div>
                </div>
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title">
                        <div class="form-check">
                            <input class="form-check-input" type="radio"
                                   id="LegallySeparatedid"
                                   name="@item.Questions.First(c=>c.Order==5).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==5).Id,"Legally Separated"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==5).Id,"Legally Separated"))" />
                            <label class="form-check-label" for="LegallySeparatedid">
                                Legally Separated
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title ">
                        <h6> @item.Questions.First(c => c.Order == 13).TheQuestion</h6>
                    </div>
                </div>
                <div class="col-sm-6 border-bottom">
                    <div class="the-row-column-title">
                        <input class="form-control width1" type="date" @bind-value="separateAgreementDate" disabled="@(enabled == 3? false:"disabled")" />
                    </div>
                </div>
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title">
                        <div class="form-check ">
                            <input class="form-check-input" type="radio"
                                   id="Widowedid"
                                   name="@item.Questions.First(c=>c.Order==5).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==5).Id,"Widowed"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==5).Id,"Widowed"))" />
                            <label class="form-check-label" for="Widowedid">
                                Widowed
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 border-bottom">
                    <div class="the-row-column-title ">
                        <h6> @item.Questions.First(c => c.Order == 14).TheQuestion</h6>
                    </div>
                </div>
                <div class="col-sm-6 border-bottom">
                    <div class="the-row-column-content ">
                        <input class="form-control width1" type="date" @bind-value="@spouseDeathDate" disabled="@(enabled == 4? false:"disabled")" />
                    </div>
                </div>
            </div>
            <div class="row bottom-padding">
                <div class="col-sm-12">
                    <div class="the-row-column-title">
                        <h6> @item.Questions.First(c => c.Order == 11).TheQuestion</h6>
                    </div>
                    <div class="the-row-column-content">
                        <span class="form-check form-check-inline">
                            <input class="form-check-input" type="radio"
                                   id="claimedyesId"
                                   name="@item.Questions.First(c=>c.Order==11).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==11).Id,"Yes"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==11).Id,"Yes"))" />
                            <label class="form-check-label" for="claimedyesId">Yes</label>
                        </span>
                        <span class="form-check form-check-inline">
                            <input class="form-check-input" type="radio"
                                   id="claimenoId"
                                   name="@item.Questions.First(c=>c.Order==11).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==11).Id,"No"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==11).Id,"No"))" />
                            <label class="form-check-label" for="claimenoId"> No </label>
                        </span>
                        <span class="form-check form-check-inline">
                            <input class="form-check-input" type="radio"
                                   id="claimedunsureId"
                                   name="@item.Questions.First(c=>c.Order==11).Id"
                                   checked="@(GetRadioState(item.Questions.First(c=>c.Order==11).Id,"Unsure"))"
                                   @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==11).Id,"Unsure"))" />
                            <label class="form-check-label" for="claimedunsureId"> Unsure </label>
                        </span>
                    </div>
                </div>
            </div>
        }
        @if (enabled == 1)
        {
            <div class="row form-bk-gray">
                <div class="col-sm-12">
                    <div class="section-title">
                        <h3 class="fw700">Spouse information</h3>
                    </div>

                </div>
            </div>
            <div class="row form-bk-gray">

                <div class="col-sm-12 col-md-5">
                    <div class="the-row-column-title dark-paurple">
                        <h6 class="dark-paurple">First Name</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control light-pink " name="first-name" type="text" @bind-value="st2.Spouse.FirstName" />
                    </div>
                </div>
                <div class="col-sm-12 col-md-2">
                    <div class="the-row-column-title">
                        <h6 class="dark-paurple">M.I</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control  light-pink" name="M-I" type="text" @bind-value="st2.Spouse.MiddleName" />
                    </div>
                </div>

                <div class="col-sm-12 col-md-5">
                    <div class="the-row-column-title">
                        <h6 class="dark-paurple  ">Last Name</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control  light-pink" name="Last-Name" type="text" @bind-value="st2.Spouse.LastName" />
                    </div>
                </div>
            </div>
            <div class="row form-bk-gray" style="padding-bottom: 45px;">
                <div class="col-sm-4">
                    <div class="the-row-column-title">
                        <h6 class="dark-paurple">Telephone</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control  light-pink" name="Telephone" type="text" @bind-value="st2.Spouse.Phone" />
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="the-row-column-title">
                        <h6 class="dark-paurple">Date of birth</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control  light-pink" name="birthdate" type="date" @bind-value="st2.Spouse.Birthday" />
                        <i>mm/dd/yyy</i>
                    </div>
                </div>
                <div class="col-sm-5">

                    <div class="the-row-column-title">
                        <h6 class="dark-paurple">Your Job Title</h6>
                    </div>
                    <div class="the-row-column-content">
                        <input class="form-control  light-pink" name="job-title" type="text" @bind-value="st2.Spouse.Occupation" />
                    </div>
                </div>
            </div>
            <div class="row bottom-top-padding">
                <div class="col-sm-4">
                    <div class="the-row-column-title">
                        <h5>Are you a U.S citizen?</h5>
                    </div>
                    <div class="the-row-column-content">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="isSCitizen" id="isSCitizen1"
                                   checked="@(st2.isSCitizen== true)" @onchange="@(()=>st2.isSCitizen= true)" />
                            <label class="form-check-label" for="isSCitizen1">Yes</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input " type="radio" name="isSCitizen" id="isSCitizen2"
                                   checked="@(st2.isSCitizen== false)" @onchange="@(()=>st2.isSCitizen=false)" />
                            <label class="form-check-label" for="isSCitizen2"> No </label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-8">
                    <div class="the-row-column-title">
                        <h5 class="section-subtitles">Last Year, your spouse was:</h5>
                    </div>
                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    A. Full-time student
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input " type="radio" name="isSFullTimeStudent" id="isSFullTimeStudent1"
                                               checked="@(st2.isSFullTimeStudent== true)" @onchange="@(()=>st2.isSFullTimeStudent= true)" />
                                        <label class="form-check-label" for="isSFullTimeStudent1">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="isSFullTimeStudent" id="isSFullTimeStudent2"
                                               checked="@(st2.isSFullTimeStudent== false)" @onchange="@(()=>st2.isSFullTimeStudent= false)" />
                                        <label class="form-check-label" for="isSFullTimeStudent2"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    <h6>B. Totally and permanently disabled</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input " type="radio" name="isSPermanentlyDisabled" id="isSPermanentlyDisabled1"
                                               checked="@(st2.isSPermanentlyDisabled== true)" @onchange="@(()=>st2.isSPermanentlyDisabled= true)" />
                                        <label class="form-check-label" for="isSPermanentlyDisabled1">Yes</label>
                                    </div>
                                    <div class="form-check  form-check-inline">
                                        <input class="form-check-input" type="radio" name="isSPermanentlyDisabled" id="isSPermanentlyDisabled2"
                                               checked="@(st2.isSPermanentlyDisabled== false)" @onchange="@(()=>st2.isSPermanentlyDisabled= false)" />
                                        <label class="form-check-label" for="isSPermanentlyDisabled2"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    <h6>C. Legally Blind</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="isSLegallyBlind" id="isSLegallyBlind1"
                                               checked="@(st2.isSLegallyBlind== true)" @onchange="@(()=>st2.isSLegallyBlind= true)" />
                                        <label class="form-check-label" for="isSLegallyBlind1">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="isSLegallyBlind" id="isSLegallyBlind2"
                                               checked="@(st2.isSLegallyBlind== false)" @onchange="@(()=>st2.isSLegallyBlind= false)" />
                                        <label class="form-check-label" for="isSLegallyBlind2"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        @foreach (var item in formSteps.Where(c => c.TheStep == 2 && c.Section == 5).ToList())
        { 
            <div class="row">
                <div class="col-sm-12">
                    <div class="the-row-column-title">
                        <div class="section-subtitle">
                            <h3 class="">Have you  @(st2.isMarried?"or your spouse":""):</h3>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12">
                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box">
                                <span>
                                    <h6>@item.Questions.First(c => c.Order == 1).TheQuestion</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               name="@item.Questions.First(c=>c.Order==1).Id"
                                               checked="@(GetRadioState(item.Questions.First(c=>c.Order==1).Id,"Yes"))"
                                               @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==1).Id,"Yes"))" />
                                        <label class="form-check-label" for="identityTheft1">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               name="@item.Questions.First(c=>c.Order==1).Id"
                                               checked="@(GetRadioState(item.Questions.First(c=>c.Order==1).Id,"No"))"
                                               @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==1).Id,"No"))" />
                                        <label class="form-check-label" for="identityTheft2"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 ">
                    <div class="the-row-column-content">
                        <div class="border-bottom">
                            <div class="inline-radio-box ">
                                <span>
                                    <h6>@item.Questions.First(c => c.Order == 2).TheQuestion</h6>
                                </span>
                                <span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               name="@item.Questions.First(c=>c.Order==2).Id"
                                               checked="@(GetRadioState(item.Questions.First(c=>c.Order==2).Id,"Yes"))"
                                               @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==2).Id,"Yes"))" />
                                        <label class="form-check-label" for="adoptedAChild1">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio"
                                               name="@item.Questions.First(c=>c.Order==1).Id"
                                               checked="@(GetRadioState(item.Questions.First(c=>c.Order==2).Id,"No"))"
                                               @onchange="@(()=>SetAnswer(item.Questions.First(c=>c.Order==2).Id,"No"))" />
                                        <label class="form-check-label" for="adoptedAChild2"> No </label>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        <div class="row">
            <div class="col-sm-12">
                <div class="the-row-column-title">
                    <h6></h6>List the names below of:
                </div>
            </div>
            <div class="col-sm-12">
                <div class="the-row-column-content">

                    <ul>
                        <li>
                            everyone who lived with you last year (other than your spouse)
                        </li>
                        <li>anyone you supported but did not live with you last year</li>
                    </ul>
                </div>
            </div>
        </div>
        <!--Start-->

        <div class="row .d-none .d-md-block border-bottom">
            <div class="col-sm-12 col-md-2">
                <div class="the-row-column-title">

                    <div class="dthe-row-column-title nopaddingsmallfont">
                        Name (first, last) Do not enter your name or spouse’s name below
                    </div>

                </div>
            </div>
            <div class="col-sm-12 col-md-2">
                <div class="the-row-column-title nopaddingsmallfont">Date of Birth</div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">Relationship to you</div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">
                    <h6></h6>Number of months lived in your home last year
                </div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">
                    <div>
                        <h6></h6>Us
                    </div>
                    <div>
                        <h6></h6>Citizen
                    </div>
                </div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">
                    Resident
                    of US,
                    Canada,
                    or Mexico
                    last year
                </div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">
                    Single or
                    Married as
                    of 12/31/19
                    (S/M)
                </div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">
                    Full-time
                    Student
                    last year
                </div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column-title nopaddingsmallfont">
                    Totally and
                    Permanently
                    Disabled
                </div>

            </div>
            <div class="col-sm-12 col-md-1">
                <div class="the-row-column- title nopaddingsmallfont"></div>

            </div>
        </div>
        <DependentForm TaxFormID="TaxFormID" OnReloadDependetEvent="OnReloadDependetEvent" />
        @foreach (Dependent d in Dependents)
        {
            <div class="row .d-none .d-md-block border-bottom dependent-row">
                <div class="col-sm-12 col-md-2">
                    <div class=" nopaddingsmallfont">
                        <p>@d.FirstName @d.LastName</p>

                    </div>
                </div>
                <div class="col-sm-12 col-md-2">

                    <div class=" nopaddingsmallfont">
                        <p>@d.Birthday.ToShortDateString()</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class=" nopaddingsmallfont">
                        <p>@d.RelationshipName</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class=" nopaddingsmallfont">
                        <p>@d.MonthInHome</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class=" nopaddingsmallfont">
                        <p>@d.isUsCitizen</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class=" nopaddingsmallfont">
                        <p>@d.ResidentUSCanadaMexicolastyear</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class="nopaddingsmallfont">
                        <p>@d.SingleorMarriedAsOf</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class="nopaddingsmallfont">
                        <p>@d.FullTimeStudentLastYear</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">

                    <div class=" nopaddingsmallfont">
                        <p>@d.TotallyPermanentlyDisabled</p>
                    </div>
                </div>
                <div class="col-sm-12 col-md-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                    </svg>

                </div>
            </div>
        }
        <!--End-->
        <div class="row">
            <div class="col-sm-12">
                <div class="step-nav-box">
                    <div class="step-nav">
                        <div id="next-step">
                            <button id="prev-step" @onclick="Prv">Previous Step</button>
                        </div>
                        <div id="next-step">
                            <button id="next-step-id" @onclick="Next">Next Step</button>
                        </div>
                        <div id="next-step">
                            <button id="revire-submit" @onclick="SubmitReview">Review & Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code{
    [Parameter]
    public EventCallback<int> NextPage { get; set; }

    [Parameter]
    public EventCallback<int> PrvPage { get; set; }

    [Parameter]
    public EventCallback<int> FinalPage { get; set; }

    [Parameter]
    public int TaxFormID { get; set; }

    [Parameter]
    public Person CurrentUser { get; set; }

    [Parameter]
    public Address UserCurrentAddress { get; set; }

    [Parameter]
    public List<Dependent> Dependents { get; set; }

    public int enabled { get; set; } = 0;


    DependentList dependentList;

    private bool ReloadDependentList { set; get; }

    public Step2VM st2 { get; set; }

    public List<FormStep> formSteps { get; set; }

    public List<Question> questions { set; get; }
    public List<Answer> answers { get; set; }
    public List<Answer> removeanswers { get; set; }

    public DateTime DateOfFinalDecree { get; set; }
    public DateTime separateAgreementDate { get; set; }
    public DateTime spouseDeathDate { get; set; }

    public int DateOfFinalDecree_q_id { get; set; }
    public int separateAgreementDate_q_id { get; set; }
    public int spouseDeathDate_q_id { get; set; }

    public bool DateOfFinalDecree_flag { get; set; } = false;
    public bool separateAgreementDate_flag { get; set; } = false;
    public bool spouseDeathDate_flag { get; set; } = false;

    protected override void OnInitialized()
    {
        st2 = new Step2VM();
        Dependents = new List<Dependent>();
        Dependents = service.GetDependets(TaxFormID);

        formSteps = new List<FormStep>();
        answers = new List<Answer>();
        answers = service.GetAnswers(TaxFormID, 2);
        formSteps = service.GetFormStep(2);

        var questions = formSteps.First(c => c.TheStep == 2 && c.Section == 2).Questions;
        DateOfFinalDecree_q_id = questions.First(c => c.Order == 12).Id;
        separateAgreementDate_q_id = questions.First(c => c.Order == 13).Id;
        spouseDeathDate_q_id = questions.First(c => c.Order == 14).Id;

        TaxForm t = service.GetTaxForm(TaxFormID);
        if (t.TaxFormPerson.Where(c=>c.isSpouse == true).Count()>0)
        {
            st2.Spouse = t.TaxFormPerson.Where(c=>c.isSpouse == true).Select(c=> new Person {
                Birthday= c.Birthday,
                Email = c.Email,
                FirstName = c.FirstName,
                id = c.id,
                LastName = c.LastName,
                MiddleName = c.MiddleName,
                Occupation = c.Occupation,
                Phone = c.Phone,
                SSN = c.SSN,
                UserId = c.UserId
            }).First();
        }
        if (t.TaxFormPerson.Where(c => c.isSpouse == false).Count() > 0)
        {
            st2.CurrentUserInfo = t.TaxFormPerson.Where(c => c.isSpouse == false).Select(c => new Person
            {
                Email = c.Email,
                FirstName = c.FirstName,
                id = c.id,
                LastName = c.LastName,
                MiddleName = c.MiddleName,
                Occupation = c.Occupation,
                Phone = c.Phone,
                SSN = c.SSN,
                UserId = c.UserId
            }).First();
        }
        else
        {
            st2.CurrentUserInfo = CurrentUser;
        }

        if (answers.Any(c=>c.QuestionId == DateOfFinalDecree_q_id))
        {
            DateOfFinalDecree_flag = true;
            DateOfFinalDecree = DateTime.Parse(answers.First(c => c.QuestionId == DateOfFinalDecree_q_id).TheAnswer);
        }
        if (answers.Any(c => c.QuestionId == separateAgreementDate_q_id))
        {
            separateAgreementDate_flag = true;
            separateAgreementDate = DateTime.Parse(answers.First(c => c.QuestionId == separateAgreementDate_q_id).TheAnswer);
        }
        if (answers.Any(c => c.QuestionId == spouseDeathDate_q_id))
        {
            spouseDeathDate_flag = true;
            spouseDeathDate = DateTime.Parse(answers.First(c => c.QuestionId == spouseDeathDate_q_id).TheAnswer);
        }

        base.OnInitialized();
    }

    public async Task Next()
    {

        if (DateOfFinalDecree.Year>1900){
            if (DateOfFinalDecree_flag){
                var model = answers.First(c => c.QuestionId == DateOfFinalDecree_q_id);
                model.TheAnswer = DateOfFinalDecree.ToLongDateString();
                model.UpdatedOn = DateTime.Now;
            }
            else {
                answers.Add(new Answer { TaxFormId = TaxFormID, QuestionId = DateOfFinalDecree_q_id, TheAnswer = DateOfFinalDecree.ToLongDateString(), AnsweredOn = DateTime.Now, UpdatedOn = DateTime.Now });
            }
        }
        if (separateAgreementDate.Year > 1900){
            if (separateAgreementDate_flag){
                var model = answers.First(c => c.QuestionId == separateAgreementDate_q_id);
                model.TheAnswer = separateAgreementDate.ToLongDateString();
                model.UpdatedOn = DateTime.Now;
            }
            else{
                answers.Add(new Answer { TaxFormId = TaxFormID, QuestionId = separateAgreementDate_q_id, TheAnswer = separateAgreementDate.ToLongDateString(), AnsweredOn = DateTime.Now, UpdatedOn = DateTime.Now });
            }
        }
        if (spouseDeathDate.Year>1900){
            if (spouseDeathDate_flag){
                var model = answers.First(c => c.QuestionId == spouseDeathDate_q_id);
                model.TheAnswer = spouseDeathDate.ToLongDateString();
                model.UpdatedOn = DateTime.Now;
            }
            else{
                answers.Add(new Answer { TaxFormId = TaxFormID, QuestionId = spouseDeathDate_q_id, TheAnswer = spouseDeathDate.ToLongDateString(), AnsweredOn = DateTime.Now, UpdatedOn = DateTime.Now });
            }
        }
        service.SaveProgressStep3(answers);
        SaveProgress(2);
        await NextPage.InvokeAsync(3);
    }
    public async Task Prv()
    {
        await PrvPage.InvokeAsync(1);
    }
    public async Task Goto(int gotoStep)
    {
        await NextPage.InvokeAsync(gotoStep);
    }

    private void OnReloadDependetEvent(bool changed)
    {
        ReloadDependentList = changed;

        Dependents = service.GetDependets(TaxFormID);
        StateHasChanged();
    }

    private void SaveProgress(int CurrentStep)
    {        
        service.SaveProgressStep2(TaxFormID, CurrentStep, st2);
    }

    public async Task SubmitReview()
    {
        await FinalPage.InvokeAsync(5);
    }
    public void SetAnswer(int qId, string qAn)
    {
        CheckIfQisConditional(qAn);
        if (answers.Any(c => c.QuestionId == qId))//update
        {
            Answer ans = answers.First(c => c.QuestionId == qId);
            ans.TheAnswer = qAn;
            ans.UpdatedOn = DateTime.Now;
        }
        else //insert
        {
            answers.Add(new Answer { TaxFormId = TaxFormID, QuestionId = qId, TheAnswer = qAn, AnsweredOn = DateTime.Now, UpdatedOn = DateTime.Now });
        }
    }
    public bool GetRadioState(int id, string val)
    {

        if (answers.Any(c => c.QuestionId == id))
        {
            var checkedval = (answers.First(c => c.QuestionId == id).TheAnswer == val) ? true : false;
            if (checkedval)
                CheckIfQisConditional1(val);
            return checkedval;
        }
        return false;
    }

    public void CheckIfQisConditional1(string qAn)
    {

        switch (qAn.ToLower())
        {
            case "never married":
                enabled = -1;
                break;
            case "married":
                enabled = 1;
                break;
            case "divoced":
                enabled = 2;
                break;
            case "legally separated":
                enabled = 3;
                break;
            case "widowed":
                enabled = 4;
                break;
        }
    }
    public void CheckIfQisConditional(string qAn)
    {

        switch (qAn.ToLower())
        {
            case "never married":
                enabled = -1;
                answers = answers.Where(c => c.TheAnswer.ToLower() != "married" && c.TheAnswer.ToLower() != "divoced" && c.TheAnswer.ToLower() != "legally separated" && c.TheAnswer.ToLower() != "widowed").ToList();

                spouseDeathDate = new DateTime();
                separateAgreementDate = new DateTime();
                DateOfFinalDecree = new DateTime();
                js.InvokeVoidAsync("ClearMarryRds");

                break;
            case "married":
                enabled = 1;
                answers = answers.Where(c => c.TheAnswer.ToLower() != "never married" && c.TheAnswer.ToLower() != "divoced" && c.TheAnswer.ToLower() != "legally separated" && c.TheAnswer.ToLower() != "widowed").ToList();
                answers = answers.Where(c => c.QuestionId != formSteps.First(c => c.TheStep == 2 && c.Section == 2).Questions.First(c => c.Order == 6).Id).ToList();
                answers = answers.Where(c => c.QuestionId != formSteps.First(c => c.TheStep == 2 && c.Section == 2).Questions.First(c => c.Order == 7).Id).ToList();

                spouseDeathDate = new DateTime();
                separateAgreementDate = new DateTime();
                DateOfFinalDecree = new DateTime();

                break;
            case "divoced":
                enabled = 2;
                answers = answers.Where(c => c.TheAnswer.ToLower() != "never married" && c.TheAnswer.ToLower() != "married" && c.TheAnswer.ToLower() != "legally separated" && c.TheAnswer.ToLower() != "widowed").ToList();

                separateAgreementDate = new DateTime();
                spouseDeathDate = new DateTime();
                js.InvokeVoidAsync("ClearMarryRds");

                break;
            case "legally separated":
                enabled = 3;
                answers = answers.Where(c => c.TheAnswer.ToLower() != "never married" && c.TheAnswer.ToLower() != "married" && c.TheAnswer.ToLower() != "divoced" && c.TheAnswer.ToLower() != "widowed").ToList();

                DateOfFinalDecree = new DateTime();
                spouseDeathDate = new DateTime();
                js.InvokeVoidAsync("ClearMarryRds");

                break;
            case "widowed":
                enabled = 4;
                answers = answers.Where(c => c.TheAnswer.ToLower() != "never married" && c.TheAnswer.ToLower() != "married" && c.TheAnswer.ToLower() != "divoced" && c.TheAnswer.ToLower() != "legally separated").ToList();

                separateAgreementDate = new DateTime();
                DateOfFinalDecree = new DateTime();
                js.InvokeVoidAsync("ClearMarryRds");

                break;
        }
    }


}
